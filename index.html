<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Train Time</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>

    <script src="https://www.gstatic.com/firebasejs/5.5.7/firebase.js"></script>
    <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col">
                <div class="jumbotron jumbotron-fluid">
                    <div class="container">
                        <h1 class="display-4">Program Express</h1>
                        <p class="lead">Train's A Coming. All Aboard.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">

                <!-- Current Employees-->
                <div class="card mb-4">
                    <div class="card-header">Current Employees</div>
                    <div class="card-body">
                        <table class="table table-sm table-hover" id='employee-table'>
                            <thead>
                                <tr>
                                    <th scope="col">Employee Name</th>
                                    <th scope="col">Role</th>
                                    <th scope="col">Start Date</th>
                                    <th scope="col">Months Worked</th>
                                    <th scope="col">Monthly Rate ($)</th>
                                    <th scope="col">Total Billed ($)</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="col-md-12">
                <!-- Add Employee  -->
                <div class="card mb-4">
                    <div class="card-header">Add Employee</div>
                    <div class="card-body">

                        <!-- Entry Form -->
                        <form>
                            <div class="form-group">
                                <label for="employee-name-input">Employee Name</label>
                                <input class="form-control" id="employee-name-input" placeholder="Jane Doe" type="text">
                            </div>
                            <div class="form-group">
                                <label for="role-input">Role</label>
                                <input class="form-control" id="role-input" placeholder="CEO" type="text">
                            </div>
                            <div class="form-group">
                                <label for="start-input">Start Date (MM/DD/YYYY)</label>
                                <input class="form-control" id="start-input" placeholder="01/08/1989" type="text">
                            </div>
                            <div class="form-group">
                                <label for="rate-input">Monthly Rate</label>
                                <input class="form-control" id="rate-input" placeholder="200000" type="text">
                            </div>
                            <button class="btn btn-primary float-right" id="add-employee-btn">Submit</button>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyAaRavzdYpq8pCV2zBlfFPLZ3tSKDUOXD4",
        authDomain: "traintime-5a51f.firebaseapp.com",
        databaseURL: "https://traintime-5a51f.firebaseio.com",
        projectId: "traintime-5a51f",
        storageBucket: "traintime-5a51f.appspot.com",
        messagingSenderId: "961001588866"
    };
    firebase.initializeApp(config);

    var database = firebase.database();
    // Assumptions
    var tFrequency = 3;

    // Time is 3:30 AM
    var firstTime = "04:30";

    $("#add-employee-btn").on("click", function (event) {
        event.preventDefault();

        // Grabs user input
        var empName = $("#employee-name-input").val().trim();
        var empRole = $("#role-input").val().trim();
        var empStart = moment($("#start-input").val().trim(), "MM/DD/YYYY").format("X");
        var empRate = $("#rate-input").val().trim();
        var newEmp = {
    name: empName,
    role: empRole,
    start: empStart,
    rate: empRate
  };

  // Uploads employee data to the database
  database.ref().push(newEmp);

  // Logs everything to console
  console.log(newEmp.name);
  console.log(newEmp.role);
  console.log(newEmp.start);
  console.log(newEmp.rate);

    alert("Employee successfully added");

// Clears all of the text-boxes
$("#employee-name-input").val("");
$("#role-input").val("");
$("#start-input").val("");
$("#rate-input").val("");
    });

    database.ref().on("child_added", function(childSnapshot) {
  console.log(childSnapshot.val());

  // Store everything into a variable.
  var empName = childSnapshot.val().name;
  var empRole = childSnapshot.val().role;
  var empStart = childSnapshot.val().start;
  var empRate = childSnapshot.val().rate;

  // Employee Info
  console.log(empName);
  console.log(empRole);
  console.log(empStart);
  console.log(empRate);

  // Prettify the employee start
  var empStartPretty = moment.unix(empStart).format("MM/DD/YYYY");

  // Calculate the months worked using hardcore math
  // To calculate the months worked
  var empMonths = moment().diff(moment(empStart, "X"), "months");
  console.log(empMonths);

  // Calculate the total billed rate
  var empBilled = empMonths * empRate;
  console.log(empBilled);

  // Create the new row
  var newRow = $("<tr>").append(
    $("<td>").text(empName),
    $("<td>").text(empRole),
    $("<td>").text(empStartPretty),
    $("<td>").text(empMonths),
    $("<td>").text(empRate),
    $("<td>").text(empBilled)
  );

  // Append the new row to the table
  $("#employee-table > tbody").append(newRow);
});
</script>

</html>